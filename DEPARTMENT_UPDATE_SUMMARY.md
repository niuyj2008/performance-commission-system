# 部门配置更新说明

## 更新日期
2024年12月14日

## 更新内容

根据权威文档 `/Users/tima/Documents/ZhangHR/项目/新规定/韶谷数码城项目奖金发放计算表(20200629）.xls` 中的部门定义，已更新系统中的部门配置。

## 新部门列表

系统现在包含以下5个部门，与权威文档中的工种分配一致：

| 序号 | 部门名称 | 部门代码 | 提成比例（参考） |
|------|----------|----------|------------------|
| 1 | 建筑部 | ARCH | 33.76% |
| 2 | 结构部 | STRUCT | 32.76% |
| 3 | 给排水部 | PLUMB | 10.75% |
| 4 | 电气部 | ELEC | 12.75% |
| 5 | 空调部 | HVAC | 9.97% |

**注意**: 提成比例仅供参考，实际计算时会根据项目的空调面积表动态调整。

## 部门经理测试账号

为每个部门创建了部门经理测试账号：

| 用户名 | 密码 | 姓名 | 部门 |
|--------|------|------|------|
| manager_arch | manager123 | 建筑部经理 | 建筑部 |
| manager_struct | manager123 | 结构部经理 | 结构部 |
| manager_plumb | manager123 | 给排水部经理 | 给排水部 |
| manager_elec | manager123 | 电气部经理 | 电气部 |
| manager_hvac | manager123 | 空调部经理 | 空调部 |

## 权限说明

部门经理可以：
- 管理本部门的员工信息
- 查看本部门的发放记录
- 查看本部门的汇总报表

## 与旧部门的对比

### 旧部门（已删除）
- 建筑一部 (ARCH1)
- 建筑二部 (ARCH2)
- 结构部 (STRUCT)
- 设备部 (MEP)

### 新部门（当前）
- 建筑部 (ARCH)
- 结构部 (STRUCT)
- 给排水部 (PLUMB)
- 电气部 (ELEC)
- 空调部 (HVAC)

## 数据迁移说明

1. **部门数据**: 已清除旧部门，创建新部门
2. **用户数据**: 保留所有用户，但之前关联到旧部门的用户需要重新分配部门
3. **项目数据**: 保留所有项目数据
4. **发放记录**: 保留所有发放记录

## 后续操作建议

1. **重新分配员工部门**: 
   - 登录系统，进入"员工管理"
   - 为每个员工重新分配正确的部门

2. **测试部门经理权限**:
   - 使用部门经理账号登录
   - 验证只能看到本部门的数据

3. **验证提成计算**:
   - 创建测试项目
   - 计算提成，验证部门分配是否正确

## 技术实现

### 更新脚本
- `server/db/update-departments.js` - 更新部门数据
- `server/db/create-department-managers.js` - 创建部门经理账号

### 数据库变更
```sql
-- 删除旧部门
DELETE FROM departments;

-- 插入新部门
INSERT INTO departments (name, code) VALUES 
  ('建筑部', 'ARCH'),
  ('结构部', 'STRUCT'),
  ('给排水部', 'PLUMB'),
  ('电气部', 'ELEC'),
  ('空调部', 'HVAC');
```

## 验证方法

1. **查看部门列表**:
   ```bash
   sqlite3 database.sqlite "SELECT * FROM departments;"
   ```

2. **查看部门经理账号**:
   ```bash
   sqlite3 database.sqlite "SELECT username, name, role, department_id FROM users WHERE role='manager';"
   ```

3. **登录系统验证**:
   - 访问 http://localhost:3000
   - 使用部门经理账号登录
   - 进入"员工管理"查看部门下拉列表

## 完成状态

✅ 部门数据已更新  
✅ 部门经理账号已创建  
✅ 数据库迁移完成  
✅ 系统可正常使用  

---

**更新完成！** 系统现在使用权威文档中定义的部门结构。
