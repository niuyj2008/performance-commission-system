# 项目数据完善需求文档

## 简介

2025年上半年的13个项目已经导入系统,但只有基本信息(名称、编码、阶段)和提成分配数据。需要补充项目的详细信息,包括建筑面积、项目属性和空调面积表,以便系统能够正确计算提成。

## 术语表

- **项目**: 设计院承接的建筑设计项目
- **建筑面积**: 项目的总建筑面积,用于提成计算的基础
- **项目属性**: 包括建筑类型、是否有地下室、是否有人防、是否绿色建筑、是否装配式建筑等
- **空调面积表**: 记录项目中各专业(建筑、结构、给排水、电气、空调)的空调面积分配
- **提成计算**: 基于建筑面积和空调面积表计算各部门应得的提成金额

## 需求

### 需求1: 补充项目建筑面积

**用户故事**: 作为系统管理员,我希望能够为已导入的项目补充建筑面积,以便系统能够正确计算提成。

#### 验收标准

1. WHEN 管理员查看项目列表 THEN 系统应显示每个项目的建筑面积
2. WHEN 项目的建筑面积为0或空 THEN 系统应提供导入或手动输入的方式补充数据
3. WHEN 从Excel文件导入建筑面积 THEN 系统应正确解析并更新到数据库
4. WHEN 建筑面积更新后 THEN 系统应重新计算该项目的提成分配(如果需要)
5. WHEN 建筑面积数据不可用 THEN 系统应允许管理员手动输入

### 需求2: 补充项目属性信息

**用户故事**: 作为系统管理员,我希望能够为项目补充详细属性(建筑类型、地下室、人防等),以便更准确地计算提成。

#### 验收标准

1. WHEN 管理员编辑项目 THEN 系统应提供表单输入以下属性:
   - 建筑类型(住宅、办公、商业等)
   - 是否有地下室
   - 是否有人防
   - 是否绿色建筑
   - 是否装配式建筑
2. WHEN 从文档中提取项目属性 THEN 系统应能够批量导入这些属性
3. WHEN 项目属性更新 THEN 系统应保存到数据库并在项目详情中显示
4. WHEN 项目属性影响提成计算 THEN 系统应根据新属性重新计算提成

### 需求3: 导入空调面积表

**用户故事**: 作为系统管理员,我希望能够为项目导入空调面积表,以便系统能够按照空调面积分配各部门的提成。

#### 验收标准

1. WHEN 管理员为项目导入空调面积表 THEN 系统应从Excel文件中读取各专业的空调面积
2. WHEN 空调面积表包含多个专业 THEN 系统应正确识别并保存:
   - 建筑专业空调面积
   - 结构专业空调面积
   - 给排水专业空调面积
   - 电气专业空调面积
   - 空调专业空调面积
3. WHEN 空调面积表导入成功 THEN 系统应在项目详情的第二级显示各专业的空调面积
4. WHEN 空调面积表已存在 THEN 系统应提供更新或覆盖的选项
5. WHEN 空调面积表格式不正确 THEN 系统应提示错误并说明正确格式

### 需求4: 数据来源识别和提取

**用户故事**: 作为系统管理员,我希望系统能够从现有的Excel和Word文档中提取项目数据,以减少手动输入的工作量。

#### 验收标准

1. WHEN 系统分析Excel文件 THEN 系统应识别包含建筑面积的列
2. WHEN 系统分析Word文档 THEN 系统应提取项目名称和对应的属性信息
3. WHEN 数据来源有多个文件 THEN 系统应能够合并来自不同文件的数据
4. WHEN 数据提取失败 THEN 系统应记录错误并允许手动补充
5. WHEN 数据提取成功 THEN 系统应生成预览供管理员确认后再导入

### 需求5: 数据验证和完整性检查

**用户故事**: 作为系统管理员,我希望系统能够验证导入的数据是否完整和正确,以确保提成计算的准确性。

#### 验收标准

1. WHEN 项目数据导入后 THEN 系统应检查以下必填字段:
   - 项目名称
   - 项目编码
   - 项目阶段
   - 建筑面积(如果需要计算提成)
2. WHEN 发现数据缺失 THEN 系统应生成报告列出缺失的字段和项目
3. WHEN 空调面积表的总和与建筑面积不匹配 THEN 系统应发出警告
4. WHEN 部门分配金额已存在但空调面积表为空 THEN 系统应标记为需要补充
5. WHEN 所有必要数据都已完整 THEN 系统应在项目列表中显示"完整"状态

### 需求6: 批量更新和导入工具

**用户故事**: 作为系统管理员,我希望有批量导入工具,能够一次性为多个项目补充数据,提高工作效率。

#### 验收标准

1. WHEN 管理员运行批量导入脚本 THEN 系统应读取指定目录下的所有相关文件
2. WHEN 脚本识别到项目匹配 THEN 系统应自动关联文件和项目
3. WHEN 批量导入执行 THEN 系统应显示进度和成功/失败统计
4. WHEN 导入过程中出错 THEN 系统应继续处理其他项目并记录错误
5. WHEN 批量导入完成 THEN 系统应生成详细报告,包括:
   - 成功更新的项目数
   - 失败的项目和原因
   - 仍需手动补充的项目列表

## 数据来源

### 可用文件

1. **空调面积表** (`2025上半年/空调面积表/`):
   - 广电西安项目空调面积表.xlsx
   - 华贸宿舍空调面积表.xlsx
   - 建业大厦项目空调面积表.xlsx
   - 科技学院33和34栋宿舍空调面积表.xlsx

2. **部门汇总文档**:
   - 结构部2025年度上半年项目情况汇总.docx
   - 设备部门2025上半年工作量统计-2025.06.30.docx
   - 项目汇总表 (建筑部余晓华)25.2-25.7.doc

3. **奖金发放表**:
   - ALL奖金发放表2025年7月8日含预支（20250716).xlsx (已使用)

### 数据映射

| 项目编码 | 项目名称 | 可能的数据来源 |
|----------|----------|----------------|
| 2025H1-SG-005 | 西安广电项目 | 广电西安项目空调面积表.xlsx |
| 2025H1-SG-003/004 | 建业大厦 | 建业大厦项目空调面积表.xlsx |
| - | 科技学院宿舍 | 科技学院33和34栋宿舍空调面积表.xlsx |
| - | 华贸宿舍 | 华贸宿舍空调面积表.xlsx |

## 优先级

### 高优先级
1. 补充重点项目(金额大的)的建筑面积和空调面积表
2. 验证已导入的提成分配数据是否正确

### 中优先级
3. 补充所有项目的建筑面积
4. 为有空调面积表文件的项目导入数据

### 低优先级
5. 补充项目属性信息
6. 为没有空调面积表的小型项目手动创建

## 约束条件

1. 不能修改已经发放的提成数据
2. 空调面积表一旦导入并用于计算,修改时需要管理员确认
3. 建筑面积必须大于0才能进行提成计算
4. 空调面积表的各专业面积总和应该合理(可以有一定偏差)

## 成功标准

1. 所有13个已导入项目都有建筑面积数据
2. 至少4个重点项目有完整的空调面积表
3. 系统能够基于完整数据正确显示提成分配
4. 数据完整性检查通过,没有关键数据缺失
