# 实施计划

- [x] 1. 搭建项目基础架构
  - 初始化前端项目（React + TypeScript + Ant Design）
  - 初始化后端项目（Node.js + Express + TypeScript）
  - 配置数据库连接（MySQL/PostgreSQL）
  - 配置开发环境和构建工具
  - 设置代码规范和Git工作流
  - _需求：所有需求的基础_

- [x] 2. 实现数据模型和数据库架构
  - 创建User、Department、Project等核心实体的数据库表
  - 创建AirConditioningTable、DepartmentCommission等关联表
  - 创建PaymentRecord、CalculationFormula等配置表
  - 实现数据库迁移脚本
  - 添加必要的索引和约束
  - _需求：2.1, 2.2, 3.1, 4.1, 5.1, 6.2, 7.1, 8.1, 11.1_

- [x] 2.1 编写数据模型的属性测试
  - **属性 3: 项目数据完整性**
  - **验证需求：需求 2.1, 2.3**

- [x] 2.2 编写数据模型的属性测试
  - **属性 4: 修改历史记录**
  - **验证需求：需求 2.2, 4.2**

- [x] 3. 实现用户认证和权限管理模块
  - 实现用户注册和登录功能
  - 实现JWT令牌生成和验证
  - 实现基于角色的权限控制（RBAC）
  - 实现权限检查中间件
  - 创建用户管理API端点
  - _需求：1.1, 1.2, 1.3, 1.4_

- [x] 3.1 编写认证模块的属性测试
  - **属性 1: 用户角色权限隔离**
  - **验证需求：需求 1.3**

- [x] 3.2 编写认证模块的属性测试
  - **属性 2: 未授权访问拒绝**
  - **验证需求：需求 1.4**

- [x] 4. 实现项目管理模块
  - 创建项目CRUD API端点
  - 实现项目查询和筛选功能
  - 实现项目追加功能
  - 实现项目历史记录功能
  - 创建项目管理前端页面
  - _需求：2.1, 2.2, 2.3, 2.4_

- [x] 4.1 编写项目管理的属性测试
  - **属性 13: 追加历史累计记录**
  - **验证需求：需求 7.5**

- [ ] 5. 实现计算公式配置模块
  - 创建计算公式配置API
  - 实现公式的增删改查功能
  - 实现公式版本管理和历史记录
  - 创建公式配置前端界面
  - 实现公式表达式解析器
  - _需求：11.1, 11.2, 11.3, 11.4_

- [ ] 5.1 编写公式配置的属性测试
  - **属性 19: 公式配置应用一致性**
  - **验证需求：需求 11.1**

- [ ] 5.2 编写公式配置的属性测试
  - **属性 20: 公式修改历史记录**
  - **验证需求：需求 11.3**

- [x] 6. 实现提成计算引擎
  - 实现基于建筑属性的提成总额计算
  - 实现计算公式的应用逻辑
  - 实现计算结果的验证
  - 实现计算历史记录
  - 创建提成计算API端点
  - _需求：3.1, 3.2, 3.3, 3.4_

- [x] 6.1 编写提成计算的属性测试
  - **属性 5: 提成计算一致性**
  - **验证需求：需求 3.2**

- [x] 6.2 编写提成计算的属性测试
  - **属性 6: 属性变化触发重算**
  - **验证需求：需求 3.3**

- [ ] 7. 实现空调面积表管理模块
  - 创建空调面积表CRUD API
  - 实现空调面积表数据验证
  - 实现空调面积表修改历史
  - 创建空调面积表前端表单
  - 实现空调面积表与项目的关联
  - _需求：4.1, 4.2, 4.3, 4.4_

- [ ] 7.1 编写空调面积表的属性测试
  - **属性 7: 空调面积表数据完整性**
  - **验证需求：需求 4.1, 4.3**

- [ ] 8. 实现部门分配计算器
  - 实现基于空调面积表的部门分配比例计算
  - 实现分配规则的配置和应用
  - 实现部门提成金额计算
  - 实现分配比例验证（总和100%）
  - 创建部门分配API端点
  - _需求：5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 8.1 编写部门分配的属性测试
  - **属性 8: 部门分配比例总和不变量**
  - **验证需求：需求 5.5**

- [ ] 8.2 编写部门分配的属性测试
  - **属性 9: 空调面积变化触发重算**
  - **验证需求：需求 5.3**

- [ ] 9. 实现部门内分配模块
  - 创建部门内分配方案API
  - 实现分配方案的创建和修改
  - 实现分配金额验证（不超过部门总额）
  - 实现分配历史记录
  - 创建部门内分配前端界面
  - _需求：6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 9.1 编写部门内分配的属性测试
  - **属性 10: 部门内分配总额约束**
  - **验证需求：需求 6.4**

- [ ] 9.2 编写部门内分配的属性测试
  - **属性 11: 分配方案数据完整性**
  - **验证需求：需求 6.2**

- [ ] 10. 实现项目追加处理功能
  - 实现项目追加记录功能
  - 实现追加后的提成重新计算
  - 实现增量提成计算（扣除已发放）
  - 实现追加前后对比展示
  - 创建项目追加前端界面
  - _需求：7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 10.1 编写项目追加的属性测试
  - **属性 12: 项目追加增量计算**
  - **验证需求：需求 7.3**

- [ ] 11. 实现提成发放记录模块
  - 创建发放记录API
  - 实现发放记录的创建和查询
  - 实现项目累计发放金额计算
  - 实现人员累计发放金额计算
  - 实现发放状态更新
  - 创建发放记录前端界面
  - _需求：8.1, 8.2, 8.3, 8.4_

- [ ] 11.1 编写发放记录的属性测试
  - **属性 14: 发放记录完整性**
  - **验证需求：需求 8.1**

- [ ] 11.2 编写发放记录的属性测试
  - **属性 15: 项目累计发放金额**
  - **验证需求：需求 8.3**

- [ ] 12. 实现半年度汇总功能
  - 实现计算周期筛选功能
  - 实现部门和人员提成汇总计算
  - 实现项目明细列表生成
  - 实现汇总报表数据结构
  - 创建半年度汇总前端页面
  - _需求：9.1, 9.2, 9.3, 9.4_

- [ ] 12.1 编写半年度汇总的属性测试
  - **属性 16: 周期项目筛选**
  - **验证需求：需求 9.1**

- [ ] 12.2 编写半年度汇总的属性测试
  - **属性 17: 半年度汇总总额**
  - **验证需求：需求 9.2**

- [ ] 13. 实现Excel导入功能
  - 实现Excel文件解析库集成（ExcelJS）
  - 实现项目清单Excel导入
  - 实现空调面积表Excel导入
  - 实现导入数据验证
  - 实现导入错误提示
  - 创建Excel导入前端界面
  - _需求：10.1, 10.2, 10.4_

- [ ] 14. 实现Excel导出功能
  - 实现提成数据Excel导出
  - 实现报表Excel导出
  - 实现Excel模板格式保持
  - 实现导出文件下载
  - 创建Excel导出前端功能
  - _需求：10.3, 10.5_

- [ ] 14.1 编写Excel导入导出的属性测试
  - **属性 18: Excel导入导出往返一致性**
  - **验证需求：需求 10.3**

- [ ] 15. 实现报表查询和生成功能
  - 实现个人提成查询API
  - 实现部门提成查询API
  - 实现全局提成统计API
  - 实现时间范围筛选功能
  - 实现报表导出（Excel和PDF）
  - 创建报表查询前端页面
  - _需求：12.1, 12.2, 12.3, 12.4, 12.5_

- [ ] 15.1 编写报表查询的属性测试
  - **属性 21: 个人提成查询准确性**
  - **验证需求：需求 12.1**

- [ ] 15.2 编写报表查询的属性测试
  - **属性 22: 时间范围筛选准确性**
  - **验证需求：需求 12.4**

- [ ] 16. 实现前端用户界面
  - 创建登录页面
  - 创建主导航和布局
  - 创建项目管理页面
  - 创建提成计算页面
  - 创建部门分配页面
  - 创建报表查询页面
  - 实现响应式设计
  - _需求：所有需求的用户界面_

- [ ] 17. 实现错误处理和日志记录
  - 实现统一的错误处理中间件
  - 实现前端错误边界
  - 实现日志记录系统
  - 实现审计日志
  - 实现错误监控和告警
  - _需求：所有需求的错误处理_

- [ ] 18. 实现安全功能
  - 实现密码加密存储
  - 实现敏感数据加密
  - 实现HTTPS配置
  - 实现CSRF防护
  - 实现XSS防护
  - 实现SQL注入防护
  - _需求：1.1, 1.2, 1.3, 1.4_

- [ ] 19. 性能优化
  - 实现数据库查询优化
  - 添加必要的数据库索引
  - 实现缓存策略（Redis）
  - 实现前端代码分割
  - 实现懒加载
  - 优化大数据量查询
  - _需求：所有需求的性能优化_

- [ ] 20. 准备部署到字节扣子平台
  - 配置生产环境变量
  - 创建Docker镜像（如果需要）
  - 配置数据库连接
  - 配置文件存储
  - 编写部署文档
  - 配置监控和日志
  - _需求：所有需求的部署_

- [ ] 21. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [ ] 22. 创建初始数据和演示数据
  - 创建初始用户账号
  - 创建部门数据
  - 创建示例项目数据
  - 创建示例计算公式
  - 创建示例分配规则
  - _需求：所有需求的初始数据_

- [ ] 23. 编写用户文档
  - 编写系统使用手册
  - 编写管理员指南
  - 编写API文档
  - 编写部署文档
  - 创建视频教程（可选）
  - _需求：所有需求的文档_

- [ ] 24. 最终检查点 - 确保所有功能正常
  - 确保所有测试通过，如有问题请询问用户
