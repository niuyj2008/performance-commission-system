# 第二级部门分配"当期发放金额"显示修复 - 任务列表

## 任务概述

修复部门经理在第二级部门分配页面看到的"当期发放金额"显示不正确的问题。

## 实施任务

- [x] 1. 修复数据加载顺序
  - 确保发放节点数据在显示第二级之前加载完成
  - 为部门经理添加`loadPaymentStagesForManager()`函数
  - 修改`loadProjectDetail()`的执行顺序
  - _需求: 用户故事1, 验收标准1-2_

- [x] 2. 添加默认发放节点处理
  - 当没有选择发放节点时,使用最新的发放节点
  - 当没有配置发放节点时,使用100%作为默认值
  - 在界面上显示提示信息
  - _需求: 用户故事1, 验收标准4_

- [x] 3. 增强部门ID映射的错误处理
  - 添加部门ID映射失败的友好提示
  - 在控制台输出调试信息
  - _需求: 用户故事1, 验收标准1_

- [x] 4. 优化当期发放金额的显示
  - 确保显示格式清晰: 总额、当期发放、已发放、剩余
  - 添加发放节点名称和比例的显示
  - 使用不同颜色区分不同类型的金额
  - _需求: 用户故事1, 验收标准5_

- [x] 5. 添加调试日志(可选)
  - 在`displayLevel2()`中添加console.log
  - 输出关键数据: 用户信息、部门分配、发放节点、计算结果
  - 便于后续问题排查
  - _需求: 技术要求_

- [x] 6. 测试验证
  - 测试有发放节点的项目
  - 测试无发放节点的项目
  - 测试多个发放节点的项目
  - 测试有已发放金额的项目
  - 验证部门经理和管理员看到的数据一致
  - _需求: 用户故事1-2, 所有验收标准_

## 完成标准

- ✅ 部门经理能看到正确的当期发放金额
- ✅ 当期发放金额 = 部门总分配 × 本期比例
- ✅ 显示清晰,包含: 总额、当期发放(带节点名称和比例)、已发放、剩余
- ✅ 没有发放节点时显示合理的默认值和提示
- ✅ 所有测试场景通过

