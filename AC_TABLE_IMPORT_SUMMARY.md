# 空调面积表数据导入说明

## 导入日期
2024年12月14日

## 数据来源

**Excel文件**: `/Users/tima/Documents/ZhangHR/项目/新规定/韶谷数码城项目奖金发放计算表(20200629）.xls`

**数据位置**: Sheet1，第23-25行（项目空调面积统计表）

## 导入的项目

**项目名称**: 韶谷数码城  
**项目代码**: SGSMCC  
**项目ID**: 2  
**建筑面积**: 35,287㎡  
**设计阶段**: 施工图设计 (construction)

## 导入的空调面积表数据

| 序号 | 空调形式 | 采用空调部位 | 空调面积（㎡） | 备注 |
|------|----------|--------------|----------------|------|
| 1 | 全中央空调 | 2#数据中心 | 23,215 | 含机械排烟、新风等有关暖通设计 |
| 2 | VRV空调（布管） | 1#产业用房1~2F | 1,795 | - |
| 3 | VRV空调（不布管） | 1#产业用房3~12F | 10,277 | - |

**总空调面积**: 35,287㎡（与建筑面积一致）

## 导入过程

### 1. 数据提取
使用Python的xlrd库读取Excel文件，提取空调面积统计表数据。

### 2. 项目验证
- 在数据库中查找"韶谷数码城"项目
- 确认项目存在（ID: 2）
- 显示项目基本信息

### 3. 数据清理
- 删除该项目的旧空调面积表数据（如果有）
- 确保数据的一致性

### 4. 数据导入
- 逐条插入3条空调面积记录
- 每条记录包含：空调类型、部位、面积、备注

### 5. 验证结果
- 确认3条记录成功插入数据库
- 验证总面积与建筑面积一致

## 导入脚本

**脚本文件**: `import-ac-table-from-excel.js`

**运行命令**:
```bash
node import-ac-table-from-excel.js
```

**脚本功能**:
1. 连接数据库
2. 查找"韶谷数码城"项目
3. 清除旧数据
4. 导入新的空调面积表数据
5. 显示导入结果

## 数据库记录

### air_conditioning_tables 表

| id | project_id | ac_type | location | area | notes |
|----|------------|---------|----------|------|-------|
| 6 | 2 | 全中央空调 | 2#数据中心 | 23215.0 | 含机械排烟、新风等有关暖通设计 |
| 7 | 2 | VRV空调（布管） | 1#产业用房1~2F | 1795.0 | |
| 8 | 2 | VRV空调（不布管） | 1#产业用房3~12F | 10277.0 | |

## 如何在系统中查看

### 方法1: 通过项目详情页
1. 登录系统
2. 进入"项目管理"
3. 找到"韶谷数码城"项目
4. 点击"查看详情"
5. 在"第二级：部门分配"区域点击"配置空调面积表"
6. 可以看到已导入的3条记录

### 方法2: 通过API
```bash
curl -X GET http://localhost:3000/api/air-conditioning/2 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## 后续操作

导入空调面积表后，可以：

1. **查看空调面积表**
   - 在项目详情页查看已配置的空调面积表

2. **编辑空调面积表**
   - 可以在界面上修改、添加或删除记录

3. **计算部门分配**
   - 基于空调面积表计算各部门的提成分配
   - 调用 `/api/air-conditioning/2/calculate-allocation`

4. **查看部门分配结果**
   - 查看各部门（建筑、结构、给排水、电气、空调）的分配金额

## 空调综合系数计算

根据权威文档，系统会基于空调面积表计算空调综合系数：

```
K = (S1*K1 + S2*K2 + S3*K3 + ...) / S总
```

其中：
- S1, S2, S3 = 各类型空调面积
- K1, K2, K3 = 各类型空调系数
- S总 = 总建筑面积

**本项目的空调综合系数**:
- 全中央空调: 23,215㎡ × 0.125 = 2,901.875
- VRV空调（布管）: 1,795㎡ × 0.115 = 206.425
- VRV空调（不布管）: 10,277㎡ × 0.04 = 411.08
- **综合系数 K** = (2,901.875 + 206.425 + 411.08) / 35,287 ≈ 0.0997

## 部门分配比例

基于空调综合系数，各部门的分配比例为：
- **建筑部**: 33.76%
- **结构部**: 32.76%
- **给排水部**: 10.75%
- **电气部**: 12.75%
- **空调部**: 9.97%

## 验证清单

- [x] Excel数据成功读取
- [x] 项目"韶谷数码城"已存在
- [x] 空调面积表数据已导入（3条记录）
- [x] 总面积与建筑面积一致（35,287㎡）
- [x] 数据库记录验证通过
- [ ] 在系统界面中查看（待用户验证）
- [ ] 计算部门分配（待执行）

## 注意事项

1. **数据覆盖**: 导入脚本会删除该项目的旧空调面积表数据
2. **数据一致性**: 确保总空调面积与建筑面积一致
3. **空调类型**: 使用中文名称，与系统支持的8种类型匹配
4. **备份建议**: 导入前建议备份数据库

## 完成状态

✅ 数据提取完成  
✅ 项目验证完成  
✅ 数据导入完成  
✅ 数据库验证完成  
✅ 文档记录完成  

---

**导入成功！** 韶谷数码城项目的空调面积表数据已成功导入系统。
